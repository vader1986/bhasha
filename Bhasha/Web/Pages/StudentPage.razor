@page "/student"
@using Bhasha.Web.Shared.Components.Student
@inherits Bhasha.Web.Pages.UserPage

<AuthorizeView Roles="Admin, Student">
    <Authorized>
        
        <MudOverlay @bind-Visible="_showChapterCompletedOverlay" DarkBackground AutoClose="true">
            <MudImage Src="@Resources.GetImageUrl("chapter-completed.jpeg")"></MudImage>
        </MudOverlay>

        <MudPaper Style="text-align: center;" Class="mt-4 pt-4 pb-4">
            @if (_error != null)
            {
                <MudAlert Severity="Severity.Error">@_error</MudAlert>
            }

            @if (_selectedProfile == null)
            {
                <SelectProfile
                    UserId="@UserId"
                    Values="@_profiles"
                    ValueChanged="@SelectProfileAsync"/>
            }

            @if (_selectedProfile != null &&
                 _selectedChapter == null)
            {
                <SelectChapter
                    UserId="@UserId"
                    Languages="@_selectedProfile.Key"
                    OnSelection="@SelectChapterAsync"/>
            }

            @if (_selectedProfile != null &&
                 _selectedChapter != null &&
                 _selectedPage != null)
            {
                <ChapterPage
                    Chapter="@_selectedChapter"
                    Page="@_selectedPage"
                    @bind-Value="_selectedProfile"
                    @bind-Value:after="@UpdateChapterAndPageAsync"/>
            }
        </MudPaper>
    </Authorized>
    
    <NotAuthorized>
        <RedirectTo Url="/Identity/Account/Login"/>
    </NotAuthorized>
    
</AuthorizeView>